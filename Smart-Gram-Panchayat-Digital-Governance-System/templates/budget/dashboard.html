{% extends 'base.html' %}

{% block content %}
<div class="container my-5">
    <h2 class="fw-bold mb-4">
        <i class="fas fa-chart-pie me-2" style="color: var(--accent)"></i>Budget Transparency Dashboard
    </h2>

    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="stat-card success">
                <h6 class="text-muted mb-2">Total Budget</h6>
                <h3 class="mb-0" style="color: var(--accent)">₹{{ total_budget|floatformat:2 }}</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card warning">
                <h6 class="text-muted mb-2">Total Spent</h6>
                <h3 class="mb-0" style="color: var(--secondary)">₹{{ total_spent|floatformat:2 }}</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card">
                <h6 class="text-muted mb-2">Remaining</h6>
                <h3 class="mb-0 text-primary">₹{{ remaining|floatformat:2 }}</h3>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title fw-bold mb-4">Department-wise Allocation</h5>
                    <canvas id="departmentChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title fw-bold mb-4">Budget Distribution</h5>
                    {% for dept in department_data %}
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span>{{ dept.name }}</span>
                            <span class="fw-bold">₹{{ dept.amount|floatformat:0 }}</span>
                        </div>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar" style="width: {{ dept.amount|floatformat:0 }}%"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title fw-bold mb-4">Recent Transactions</h5>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Department</th>
                            <th>Title</th>
                            <th>Allocated</th>
                            <th>Spent</th>
                            <th>Financial Year</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in records %}
                        <tr>
                            <td><span class="badge bg-primary">{{ record.get_department_display }}</span></td>
                            <td>{{ record.title }}</td>
                            <td>₹{{ record.allocated_amount|floatformat:2 }}</td>
                            <td>₹{{ record.spent_amount|floatformat:2 }}</td>
                            <td>{{ record.financial_year }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center">No records found</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('departmentChart');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: [{% for dept in department_data %}'{{ dept.name }}',{% endfor %}],
            datasets: [{
                data: [{% for dept in department_data %}{{ dept.amount }},{% endfor %}],
                backgroundColor: ['#1e3a8a', '#f59e0b', '#059669', '#dc2626', '#6366f1']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
</script>
{% endblock %}
{% endblock %}
